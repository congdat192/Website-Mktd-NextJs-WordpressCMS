<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet" />
    <title>Hello world project</title>
  </head>

  <body>
    <div id="root"></div>

    <!-- Early global fetch wrapper and targeted unhandledrejection handler.
         This runs before the app and third-party scripts so we can catch or
         log noisy third-party network failures (eg. FullStory) while preserving
         legitimate errors for debugging. -->
    <script>
      (function () {
        if (typeof window === 'undefined') return;

        // Preserve original fetch with aggressive error handling
        try {
          const originalFetch = window.fetch && window.fetch.bind(window);
          if (originalFetch) {
            window.fetch = async function (input, init) {
              try {
                return await originalFetch(input, init);
              } catch (err) {
                const url = (typeof input === 'string' && input) || (input && input.url) || '';
                const msg = err && err.message ? err.message : String(err);
                const stack = err && err.stack ? String(err.stack) : '';

                // Check if FullStory is involved in the error stack
                const isFullStoryInvolved = /edge\.fullstory\.com|fs\.js|fullstory/i.test(stack) ||
                                           /fullstory/i.test(String(url));

                // If FullStory is involved, suppress the error completely
                if (isFullStoryInvolved || (msg.includes('Failed to fetch') && stack.includes('eval'))) {
                  console.warn('[fetch] Suppressed FullStory/third-party error:', msg.slice(0, 50));
                  // Return a mock success response to prevent error propagation
                  return new Response(JSON.stringify({ ok: false, suppressed: true }), {
                    status: 200, // Use 200 to prevent rejection handlers from firing
                    statusText: 'OK',
                    headers: { 'Content-Type': 'application/json' }
                  });
                }

                // For all other errors, rethrow so app-level handlers can handle them.
                throw err;
              }
            };
          }
        } catch (e) {
          // noop
        }

        // Aggressive unhandledrejection suppression for FullStory interference
        try {
          window.addEventListener('unhandledrejection', function (e) {
            try {
              const reason = (e && e.reason) || e;
              const msg = String((reason && (reason.message || reason)) || reason || '');
              const stack = String((reason && reason.stack) || '');
              const name = String((reason && reason.name) || '');

              // Check if this error involves FullStory
              const isFullStoryInStack = /edge\.fullstory\.com|fs\.js|fullstory/i.test(stack);
              const isSupabaseInStack = /@supabase|supabase-js/i.test(stack);
              const isFetchError = msg.includes('Failed to fetch') ||
                                   msg.includes('Network request failed') ||
                                   name === 'TypeError';

              // AGGRESSIVE: Suppress ANY error that has FullStory in the stack
              // This includes fetch errors that went through FullStory's wrapper
              if (isFullStoryInStack && isFetchError) {
                console.warn('[global] Suppressed FullStory error' + (isSupabaseInStack ? ' (Supabase)' : '') + ':', msg.slice(0, 50));
                e.preventDefault();
                return;
              }

              // Also catch eval-wrapped errors (FullStory uses eval)
              if (isFetchError && /eval/.test(stack) && stack.includes('messageHandler')) {
                console.warn('[global] Suppressed eval-wrapped fetch error:', msg.slice(0, 50));
                e.preventDefault();
              }
            } catch (ignore) {}
          });
        } catch (e) {
          // noop
        }
      })();
    </script>

    <script type="module" src="/client/App.tsx"></script>
  </body>
</html>
